<h1>Home</h1>

<%if(locals.user){%>
<form action="/posts/create" method="POST">
<textarea name="content" cols="30" rows="2" placeholder="Type here to Post" required></textarea>
<input type="submit" value="Post">
</form>
<%}%>

<div id='wall'>
    <h3>Posts</h3>


    <ol>
        <%for(let post of posts){%>
            <li>
                
                <p>
                    <%if(locals.user && locals.user.id == post.user._id){%>
                    <a href="/posts/destroy/<%=post._id%>">X</a>
                    <%}%>
                    <%=post.content%>
                </p>
                <p><%=post.user.name%></p>
                <%if(locals.user){%>
                <p><a data-likes ='<%=post.likes.length%>' href="/likes/toggle?id=<%=post._id%>&type=Post"><%=post.likes.length%></a></p>
                <%}else{%>
                   <p><%=post.likes.length%></p>
                <%}%>
                <div>

                    <%if(locals.user){%>
                    <form action="/comments/create" method="POST">
                        <input type="text" name='content' placeholder="Type Here to Comment" required>
                        <input type="hidden" name='post_id' value='<%=post._id%>'>
                        <input type="submit" value='Comment'>
                    </form>
                    <%}%>

                    <h4><em> Comments - </em></h4>
                        <ul>
                        <%for(let comment of post.comments){%>
                            <li>
                                <p>
                                    <%if(locals.user && (locals.user.id == comment.user._id || locals.user.id==post.user._id)){%>
                                    <a href="/comments/destroy/<%=comment._id%>">DEL</a>
                                    <%}%>
                                    <%=comment.content%>
                                </p>
                                <p><%=comment.user.name%></p>
                                    <%if(locals.user){%>
                                    <p><a data-likes ='<%=comment.likes.length%>' href="/likes/toggle?id=<%=comment._id%>&type=Comment"><%=comment.likes.length%></a></p>
                                    <%}else{%>
                                        <%=comment.likes.length%>
                                    <%}%>
                                </li>
                        <%}%>
                    </ul>
                </div>
            </li> 
        <%}%>
    </ol>
</div>

<%if(locals.user){%>
<section id='users'>
    <h3>Users</h3>
    <ul>
        <%for(let user of users){%>
           <li><a href="/users/profile/<%=user._id%>"> <%=user.name%> </a></li>
        <%}%>
    </ul>
</section>
<%}%>

